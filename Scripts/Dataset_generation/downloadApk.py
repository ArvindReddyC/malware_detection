
import requests
import pickle 



# ##return the number of SHA keys 

# for each in [ '/Users/arvindchandrasekarreddy/Desktop/SIT723/FIles /SAMPLE OF 2000/sha256_Good.txt' , '/Users/arvindchandrasekarreddy/Desktop/SIT723/FIles /SAMPLE OF 2000/sha256_bad.txt' ]:
#     with open(each, "rb") as fp:   # Unpickling
#         all_sha = pickle.load(fp)
#         print(len(all_sha))


# with open("sha256_bad611.txt", "rb") as fp:   # Unpickling
#      all_sha = pickle.load(fp)

# done = []

# counter = 601
# try:
#     for each in all_sha[601:]:
#         url = "https://androzoo.uni.lu/api/download?apikey=f7540f1d3b803e972320eaa7bdb7d320205464805beac9f25c9f4ef5a0380aa8&sha256=" + each
#         r = requests.get(url, allow_redirects=True)
#         open(each +'.apk', 'wb').write(r.content)
#         done.append(each)
#         print( 'Done = ',counter)
#         counter = counter + 1
# except:
#     print('error in',each)
#     with open("done.txt", "wb") as fp:   #Pickling
#         pickle.dump(done, fp)



# import requests
# import pandas as pd 
# from multiprocessing.pool import ThreadPool
 
# df = pd.read_csv('/Users/arvindchandrasekarreddy/Desktop/AndroidMalwareDetection/Files/AndroZoo_files/sub_set_good_1500.csv'  )

# def download_url(each):
#   url = "https://androzoo.uni.lu/api/download?apikey=f7540f1d3b803e972320eaa7bdb7d320205464805beac9f25c9f4ef5a0380aa8&sha256=" + each  
#   #print("downloading: ",each)
#   r = requests.get(url)
#   if r.status_code == requests.codes.ok:
#     with open( r'/Users/arvindchandrasekarreddy/Desktop/AndroidMalwareDetection/Files/good_guys_apk/'+ each +'.apk', 'wb') as f:
#         f.write(r.content)
#   return each
 
 

# urls = list(df['sha256'])

# print(len(urls))
# # Run 5 multiple threads. Each call will take the next element in urls list
# results = ThreadPool(30).imap_unordered(download_url, urls)
# for r in results:
#     print(r)


'''
Version 2
'''

import requests
import pickle 


import requests
import pandas as pd 
from multiprocessing.pool import ThreadPool
 
df = pd.read_csv('/Users/arvindchandrasekarreddy/Desktop/t3_SIT724/Androzoo_Meta data/500_good_stuff.csv'  )
downloading = pd.read_csv('/Users/arvindchandrasekarreddy/Desktop/t3_SIT724/Androzoo_Meta data/downloaded.csv'  )


def download_url(each):
  url = "https://androzoo.uni.lu/api/download?apikey=f7540f1d3b803e972320eaa7bdb7d320205464805beac9f25c9f4ef5a0380aa8&sha256=" + each  
  #print("downloading: ",each)
  r = requests.get(url)
  if r.status_code == requests.codes.ok:
    with open( r'/Users/arvindchandrasekarreddy/Desktop/t3_SIT724/Androzoo_Meta data/AndrozooAPKs/'+ each +'.apk', 'wb') as f:
        f.write(r.content)
  return each
 
 

urls = list(set(list(df['sha256'])) - set(downloading['sha256']))

print(len(urls))
# Run 5 multiple threads. Each call will take the next element in urls list
results = ThreadPool(30).imap_unordered(download_url, urls)
for r in results:
    print(r)


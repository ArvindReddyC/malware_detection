import  xml.etree.ElementTree as ET 
import pandas as pd
import os 
import glob
import pickle
'''
Version 1 
'''

# i = 1 
# dict = {}
# goodfiles = []
# badfiles = []

# #,'meta-data','category','activity'
# #['uses-permission','action','receiver','service','provider']

# def get_items(root,class_lab):
#     _list = {}
#     for item in ['uses-permission','action','service']:
#         for each_i in root.iter(item):
#             action = each_i.get('{http://schemas.android.com/apk/res/android}name')
#             if action:
#                 _list[action] = 1
#     if(class_lab):
#         _list['class_label'] = class_lab
#     return _list


# for file in glob.glob("/Users/arvindchandrasekarreddy/Desktop/AndroidMalwareDetection/Files/2500_good/*.xml"):
#     goodfiles.append(file)

# for each in goodfiles:
#     print(each)
#     tree = ET.parse(each)
#     root = tree.getroot()
#     li =  get_items(root,0)
#     dict[each.split('/')[-1].split('.')[0]]  = li
#     i = i +1 



# for file in glob.glob("/Users/arvindchandrasekarreddy/Desktop/AndroidMalwareDetection/Files/2500_bad/*.xml"):
#     badfiles.append(file)


# for each in badfiles:
#     print(each)
#     tree = ET.parse(each)
#     root = tree.getroot()
#     li =  get_items(root,1)
#     dict[each.split('/')[-1].split('.')[0]]  = li
#     i = i +1 





# df = pd.DataFrame.from_dict(dict, orient='index' )
# df.fillna(0,inplace=True)
# intDf = df.astype(int)
# intDf.to_csv('only_permissions_actions_service.csv')
# print(intDf.shape)

# #with open('AllDict.pickle', 'wb') as handle:
#     #pickle.dump(dict, handle, protocol=pickle.HIGHEST_PROTOCOL)



# # for uses_permission in root.findall('uses-permission'):
#     #     print(uses_permission.attrib)
#     #     perm = uses_permission.get('{http://schemas.android.com/apk/res/android}name')
#     #     permisssion_list.append(perm)
#     # for child in root:
#     #     print(child.tag, child.attrib)


'''
Version 2 
'''


i = 1 
dict = {}
goodfiles = []
badfiles = []

#,'meta-data','category','activity'
#['uses-permission','action','receiver','service','provider']

def get_items(root,class_lab,sub_class):
    _list = {}
    for item in ['uses-permission','action','service']:
        for each_i in root.iter(item):
            action = each_i.get('{http://schemas.android.com/apk/res/android}name')
            if action:
                _list[action] = 1
    if(class_lab):
        _list['class_label'] = class_lab
        _list['sub_class'] = sub_class
    return _list


for file in glob.glob("/Users/arvindchandrasekarreddy/Desktop/AndroidMalwareDetection/Files/2500_good/*.xml"):
    goodfiles.append(file)

for each in goodfiles:
    print(each)
    tree = ET.parse(each)
    root = tree.getroot()
    li =  get_items(root,0,0)
    dict[each.split('/')[-1].split('.')[0]]  = li
    i = i +1 


goodfiles.clear()

for file in glob.glob("/Users/arvindchandrasekarreddy/Desktop/t3_SIT724/Androzoo_Meta data/xmls/*.xml"):
    goodfiles.append(file)

for each in goodfiles:
    print(each)
    tree = ET.parse(each)
    root = tree.getroot()
    li =  get_items(root,0,0)
    dict[each.split('/')[-1].split('.')[0]]  = li
    i = i +1 



#Adware
for file in glob.glob("/Users/arvindchandrasekarreddy/Desktop/PythonProjects/malware_detection/APKs_from_CICDroid/Adware/XMLs/*.xml"):
    badfiles.append(file)


for each in badfiles[:1000]:
    print(each)
    tree = ET.parse(each)
    root = tree.getroot()
    li =  get_items(root,1,1)
    dict[each.split('/')[-1].split('.')[0]]  = li
    i = i +1 

badfiles.clear()

#Banking 
for file in glob.glob("/Users/arvindchandrasekarreddy/Desktop/PythonProjects/malware_detection/APKs_from_CICDroid/Banking/XMLs/*.xml"):
    badfiles.append(file)


for each in badfiles[:1000]:
    print(each)
    tree = ET.parse(each)
    root = tree.getroot()
    li =  get_items(root,1,2)
    dict[each.split('/')[-1].split('.')[0]]  = li
    i = i +1 

badfiles.clear()

#Sms
for file in glob.glob("/Users/arvindchandrasekarreddy/Desktop/PythonProjects/malware_detection/APKs_from_CICDroid/SMS/XMLs/*.xml"):
    badfiles.append(file)


for each in badfiles[:1000]:
    print(each)
    tree = ET.parse(each)
    root = tree.getroot()
    li =  get_items(root,1,3)
    dict[each.split('/')[-1].split('.')[0]]  = li
    i = i +1 

df = pd.DataFrame.from_dict(dict, orient='index' )
df.fillna(0,inplace=True)
intDf = df.astype(int)
intDf.to_csv('/Users/arvindchandrasekarreddy/Desktop/PythonProjects/malware_detection/Evaluating_dataset/OneR_dataset/permissions+actions+service.csv')
print(intDf.shape)

#with open('AllDict.pickle', 'wb') as handle:
    #pickle.dump(dict, handle, protocol=pickle.HIGHEST_PROTOCOL)



# for uses_permission in root.findall('uses-permission'):
    #     print(uses_permission.attrib)
    #     perm = uses_permission.get('{http://schemas.android.com/apk/res/android}name')
    #     permisssion_list.append(perm)
    # for child in root:
    #     print(child.tag, child.attrib)

